# KOBE_FOC

## 这是一个功能相对完善的FOC开发板

硬件部分使用立创eda制作，四层板

使用立创EDA专业版导入即可

板子的主控为stm32g431cbu6。

板子上接出了一路IIC，一路SPI，一路RS485，一路CAN，一路直出串口，一路串口转usb。

额外还有四个按钮，一个128*64的OLED屏幕，和一个可编程LED指示灯，芯片上四个没有用到的引脚被接出到四个焊盘上，可以焊接排针使用。
这些资源对于一个FOC开发板来说应该算是相当丰富了.

总电源支持8-24V输入。

栅极驱动器是EG2133，自带死区控制且相对廉价。

采样电阻是三电阻InLine的，采样不需要考虑采样窗口，使用50倍的差分放大器进行放大之后连接到单片机的ADC1。

***************************************************************

软件部分使用CUBEMX开发，编辑器是Vscode的Embedded IDE插件。

由于EIDE对工程的改动不会体现在Keil5工程文件中。

所以软件部分直接导入到keil5可能需要在工程中添加库文件。

OLED驱动移植了u8g2库，写了串口控制器，可以解析简单的指令。

软件部分实现了有感foc的速度环和位置环，电流开环。

由于放大器布局不好，电流采样噪声不好滤除，电流闭环效果差，暂时只使用电流开环。

经测试稳定性较好，在700KV的航模电机上运行角度定位精度在±0.5°以内。

暂时打算应用在智能车上，效果应该可以碾压直流有刷电机。

对应的wpf上位机还在完善中，暂不开源。
